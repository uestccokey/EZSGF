/** Copyright by Barry G. Becker, 2000-2011. Licensed under MIT License: http://www.opensource.org/licenses/MIT */
package cn.ezandroid.sgf.demo;

import java.io.Serializable;

/**
 * Zobrist Hash表
 * <p>
 * 实现了棋盘的每个状态都有一个唯一的Hash值
 * 参见 http://en.wikipedia.org/wiki/Zobrist_hashing
 *
 * @author Barry Becker
 */
public final class ZobristHash implements Serializable {

    private static final long serialVersionUID = 42L;

    public static final int STATE_EMPTY = 0;
    public static final int STATE_BLACK = 1;
    public static final int STATE_WHITE = 2;

    // 3*19*19
    private long[][][] RANDOM_TABLE = new long[][][]{
            {
                    {902882491532829926L, 303331575839660663L, 7449544573896043481L, 3092090196943101957L, 4515887688766405296L, 8485471608639916364L,
                            -1564772793901276034L, 7715269754393139940L, 991488739685251870L, -2915796660536002959L, 313433498834020999L,
                            -4404010327959529452L, -4716395407876754076L, -5452598226460805340L, 4962782894064117476L, 5550625371534933534L,
                            781973413594516942L, 8455567457433243097L, -1778708634586573609L},
                    {8227737631728386045L, 8270872812563303479L, 723648541720698038L, -1445088331145414535L, -8498765288655079517L,
                            -6093377388955714926L,
                            -7310773146055366636L, -2499809194554317515L, -3709257902229417867L, 5071490685841855333L, 476658722769053956L,
                            -8075495338298583989L, 2591140318642946506L, 1394629967913664585L, 7177315859912929223L, -5485356936544580786L,
                            -6466645678464640657L, -6051376209447475092L, -2028129210668673451L},
                    {-6770082322367819097L, -703944364349925850L, 1133359178040479502L, -7895134813238279464L, 7591546015720422416L,
                            -7830526127179836894L,
                            3715633559418323463L, 1604588701429266990L, -4456960421345806055L, 3017309336079367564L, -1067088081476708288L,
                            4609556339529384554L, 4073428211282756006L, 5350107726940858626L, -3657944742620102603L, 9075211076681635154L,
                            -8038017144705725842L, -8520571636246470638L, -6612064755750773126L},
                    {8257174703982584547L, 2355678841264999294L, -860247574536612924L, 7740080569807846451L, -3409116500324064311L,
                            -6617976123734124875L,
                            -2272421116099013363L, -2829341779029572198L, 5926667346809928680L, -3814159343230042555L, -5594291071933866147L,
                            -858153158078326660L, 1617048216202308822L, -6343381826178299080L, -3984201317199039726L, 5299672424275239612L,
                            -908431761872742306L, -1249228325979028503L, -1995916954815561726L},
                    {-5552578638317268785L, 5832425848058483454L, -2487301121748532601L, -7407875794293415946L, 8454841873775578175L,
                            -1033997259087051159L
                            , -7819666560441197675L, -893023195500306135L, -4822845272408716759L, -6364563528460573689L, -8611520686947330963L,
                            6128638150496821453L, 6446461156843514302L, 6000519767976978288L, -3016936759947335240L, -5574099089180838522L,
                            -622753269211651387L, -5687312836999845643L, 228084049960265207L},
                    {-3908968701216970259L, 5210933038171160L, 7951894722924101655L, 925627860299892734L, -7748619535186262258L,
                            -5729547685324324318L,
                            -5621184596550289907L, 8944136989158422899L, 4868142989128036074L, -988622049653893784L, -3977499954545293245L,
                            7988376490457945427L, 5180644338120771318L, -30273998721586947L, -1409710797248234794L, -6960276837179687314L,
                            -9116364594578378086L, -2340227528724162293L, 3176526222322858776L},
                    {-6974349444675271194L, 9123486405681569204L, 6376616230557040977L, 6238617060288713234L, -6101822479597723212L,
                            -3331480324427016430L,
                            795670585264839584L, 7331325481386223357L, -4906948037410933981L, -1637974468739876101L, 486044560462114397L,
                            5981499774247604680L, -5606600660396483245L, 9212852536729005479L, 5801354131903204099L, 7902438235537571222L,
                            -3280253059346469961L, -5649383875462617662L, -9217114591700509538L},
                    {4848422187841411901L, 721119471878146200L, -222003143809169683L, -3401540551603370416L, -1503261995896953913L,
                            -2667924248760958065L,
                            -318944522385519555L, -4632319766871338545L, 988404276029926132L, 3093470702505519119L, 7773226771922879162L,
                            -7503711654703895067L, 5881674400837190071L, -7329850356920146983L, 3930384760970204129L, 1953994431995477231L,
                            -1193242181199419211L, 9059731614363123077L, 8784935844636794915L},
                    {-3686264308710509729L, 1035398151156126409L, 925916273867234048L, 5146313773994289508L, 4725331297316816443L,
                            3728684263184660355L,
                            -2660337053613893624L, -6012076837381173891L, 4408823350608013723L, 9203072369302468004L, 4241699595429162162L,
                            -3109758315716718406L, 6290274814074019630L, -6220532396070763101L, -4844321232514194459L, -8196356226244298660L,
                            6053843359482041526L, -5820146792419083221L, -7585444379979341348L},
                    {4496740392209675543L, 6713427417666359943L, -1090089343196898149L, 7046435134565563048L, 7089668629435620758L,
                            -3560480572849194484L,
                            543168681202219908L, 5115566209783617708L, 565636157727373555L, 6211394895726629954L, -667764607368367825L,
                            7371450495624213279L, 5330237868538272063L, -4690206117778444229L, 9150942299614878741L, -242097273966881650L,
                            -4516886908304374272L, -2625475524297059939L, 4379396642440639332L},
                    {-8032870448248295081L, 122501114649786029L, -5946443150293012703L, -1148237661725398655L, 3948476149761199662L,
                            -5362606487889011404L,
                            1173764407105519892L, -4517086245137867136L, -3207472293448501604L, -6729924992966033291L, -1501006599679746087L,
                            -7458335309024599378L, 1498751812138206075L, -1778417649305590075L, 2709514487293899364L, -6674922951497512696L,
                            -3985120555700964997L, 1022580362358771820L, 7226517127810919616L},
                    {-558908140061390399L, 1706173389004801953L, 2767019668274053671L, -2240839415653949813L, -2675762022133730112L,
                            2424969425983311299L,
                            -1216862461270286426L, -8811126451499314827L, -8561794626926857185L, 8359563390545580813L, 5055659676123403791L,
                            -3143209471772100667L, -7054564469019205971L, -3292163547349318530L, 8599110304192321145L, 378914850433329875L,
                            616182879401564781L, -3084820655831133333L, -4775063423859007374L},
                    {4270971587577477519L, 5579368718011404053L, -764482846430155780L, 4960752234181041274L, -7058344469673539847L,
                            5418703480648099984L,
                            -5544953481943860310L, 4277239782672926342L, -6141844282620512090L, -123029879235581571L, -6082332190536841272L,
                            1573626443506231422L, 1309828435549844802L, -3057470399165493843L, -7284007177032248329L, -883353945823157057L,
                            614685120790197000L, -112412110858961752L, 8553399094961248431L},
                    {3852824712063914137L, 175249787146344012L, -5731518589030429655L, 938563563805886909L, -5303691636871799087L,
                            8640198957499146226L,
                            -1696269721833090402L, -3343442002230694721L, -3885955940468024799L, 7864864384459615220L, 3714714566724979113L,
                            -3505642170112049238L, 1155080342864211892L, 3366458794948591583L, 2490263964589097121L, 441860340960735045L,
                            7921056246246377898L, -1928663608577873578L, -4705125552706232558L},
                    {-2969384146999059029L, 282707385838483866L, 7114974056622304398L, -2261422879167776967L, -9086936861404645171L,
                            -4933857461621001461L,
                            -3290267676366372143L, -7277869909061113720L, 2867227087482691822L, 2690648949123765753L, -4554528676282488581L,
                            179529765737435688L, 3091160808996577061L, -5305229116187014825L, 5413765866349755904L, 8976895589524362610L,
                            5714872215803833310L, 1869609731521783175L, 2197306682682339684L},
                    {7465818473997838453L, 8440654662306153817L, 4126554614882299619L, 6539314652661416385L, 6789590552981436532L,
                            6140281592814261802L,
                            -3585319322227253192L, 6314587614843538245L, -8012538127522931611L, 4181299127386827703L, -3233090233200999098L,
                            -4440044119595522511L, -5785499119459264654L, 5263022490215464125L, -1943740118226459327L, -8632547873754000037L,
                            -6237921023218717828L, -7872324997626232884L, -4946576067633431213L},
                    {-8649046351339436883L, 1147605668116282259L, -3879854110521290298L, 3086841585379265304L, 1444572464431290275L,
                            5818437005419609727L,
                            3925972013549644900L, -4134572763974375648L, -2083438986309777455L, 847571401035284795L, 3193453561560591537L,
                            1619167986260717424L, 3256892770508542811L, -4860526117546231436L, 2127655479558793613L, -8841200257025801727L,
                            6407650221603224444L, -7295246929773893618L, 1844903409833122347L},
                    {-6957540004789647552L, -3906405485272837377L, 1014317028838591391L, 7660212231927385235L, -841657731115774836L,
                            1761162044245253321L,
                            5946126168473084658L, -3260785244723385311L, -898126673176187204L, 4226230374401374797L, -993910961187438714L,
                            -2789882641639811068L, 7604979591721833622L, -1755216567345288682L, -8510055826735568883L, 7988843137792608704L,
                            -3148964105291925159L, -3202977193096718783L, -1882772029820384531L},
                    {4088565335225699244L, -6578831984465361100L, 3674740184502760192L, -1949283900426731326L, -4930658615821877387L,
                            -6512886228584463924L
                            , 6199938500226641176L, -5204491406699667750L, -6234776788767869799L, 3302124634438975674L, 1153718014101874787L,
                            189116301325359543L, -7027517389101740307L, 8520937115705965067L, 1151817006977371727L, 2331447283162691473L,
                            -6242590520836686568L, 7651020387099172030L, 4894123461743864926L}
            },
            {
                    {4991721890971505362L, 1806443922388107029L, -8399179461647041718L, -2400278401604722012L, -8572166242252215144L,
                            2943096304529161397L,
                            1204472261216978453L, -6950835186707340724L, -1233997027465883850L, 5767518910635748379L, 4068303525025895934L,
                            -8668093174305702893L, 6608932580726669491L, 3187813981882107966L, -1797127513217726764L, 4701265390309686987L,
                            723951446263498057L, 3957423069666613098L, 811542638388240860L},
                    {1747757890314200538L, 8325564461288403431L, -5041147112558067265L, -1153107582314129329L, -8207267412335601736L,
                            -2822669557034414416L
                            , -4527825495051028559L, -7560189035370623527L, 4344909211022865525L, -8651856624873715334L, 1658588367191468166L,
                            8393184760666845980L, -927271935230954448L, -4452185842021091248L, -5072573185446328101L, 7355184800281751595L,
                            -4737962905549236831L, -6132516144652178447L, -7979560156986840800L},
                    {-8060190976442179825L, -4632326496171533168L, -614883941994163634L, -6823879620688651241L, -2667797479111649723L,
                            -6894350046125989797L, 3716504274986395919L, 6564054997637737817L, 3051728457594389310L, -6187258424394896779L,
                            5345794843310489615L, 3946933327780128721L, 848663213022926046L, -9184929880559704863L, -5901433084472194084L,
                            3954744573768133694L, -8881350074426706434L, -3510876722886928197L, -1430095214957983688L},
                    {-8744438256971065418L, -2421296815852300309L, 4058695968823835823L, -6221511699995858277L, -811708207204582882L,
                            -4012471199173047068L
                            , 4499723823687701376L, 1291319612299420846L, -6438620791713342286L, -1124381174736932193L, -1668562373164180861L,
                            9070218868621211345L, 222789885172668548L, 4177709336562609348L, 7086231704318167073L, -5678428047097130346L,
                            8937204356420254964L, 1346386686867025777L, -1956260545783801256L},
                    {6948502706711956803L, -7839389584265836995L, -23045911465895500L, -2870599667638340293L, -3172661561110551979L,
                            3341586547799614440L,
                            7080583997663748116L, 2974758014174105966L, 7202817356563727864L, 1334362123449519959L, -6988205281979234551L,
                            -8800908852227261782L, 4137576033798457231L, 2866336113098682940L, 5113449420036058495L, 6156736736555195967L,
                            4122186415921644594L, -438775151169217250L, -7035236535157053608L},
                    {38825169646479757L, 4436835303784294699L, -4363961375500431909L, -2218049157998729241L, 6040934957534787722L,
                            -3786534083112499592L,
                            3737539594906453537L, -1043529023217402763L, -7785003828825435073L, 4665057280642609485L, 837277278881493491L,
                            -5776283840378415425L, 2640875357834871115L, 1239021808105174671L, -7312541148319523286L, 1935205678806886262L,
                            8953049321325272670L, 555846408242896217L, 2884186679324999409L},
                    {8560833585857743038L, 8853848105347404479L, -6188365840412116613L, 5660910144438404681L, 3028416185641744559L,
                            2498804480526257351L,
                            -3622405102928359946L, 6740969751092791939L, -5758250452441127977L, 2092831361951846500L, 2544054822497206145L,
                            -1722183224832820024L, 81891793326702519L, 7972457935836566935L, 86078995211491079L, -4581650600626802796L,
                            1114315622199260481L, 4227091144922593014L, -380222960636586969L},
                    {-4442102528621400777L, -8542137307525391519L, 8915884891604611115L, -2004189932859240525L, -452273545768706477L,
                            -2135505293496254095L
                            , 2826063357201902706L, -4973487667928928719L, -2070847595426480031L, -4565304831761364542L, 5043683938929698079L,
                            -8523914352577846691L, -4513588767257105364L, 6105287260811564058L, 3161873337239359510L, -4010950664059191387L,
                            4610288538709044307L, -4071177228338169807L, 2110095521400594001L},
                    {-1678069111309476693L, -1344975090385001525L, -2026240152562315213L, 6975444171003202142L, -5188055115765021241L,
                            6865189426528060508L
                            , 6572401645243306817L, -1096250320051652898L, -151216763527037053L, 3996833800496698655L, -8616820004271128593L,
                            -4676007874676679416L, 5380231459491780893L, -7293338860771391226L, 7070006285703222983L, -4346347640113444061L,
                            3838899786827271944L, 1909532099825771860L, 6925696427521074373L},
                    {-2560606268449295601L, 7157314140610166123L, -9208371953358538719L, 8431458148256849370L, -2598726784444151619L,
                            -7749216711950032224L
                            , 7463769468089360087L, -2245452594894403734L, 97201474959356082L, -7827690268665679434L, 1394197430310051000L,
                            -8219268564838141235L, 8952028022804397705L, 6829954675064567024L, 8440917546480632149L, -2486325427706099759L,
                            -8436650441122905234L, 1506117496455462980L, -1003908686025482472L},
                    {5008144465301872438L, 4184390725263109283L, 3181787362383573981L, 588672837605806523L, -1875457424328823503L,
                            -3924580945018326530L,
                            5503708692461571738L, -7268555037076220721L, 5168456450560867306L, 4680508689422111849L, -6077479555830558580L,
                            6403618029875866167L, -3811145271309568514L, -3679493746873684894L, 3060642270108413308L, 6407449153242697898L,
                            -1630132887672274691L, 1425511308909906040L, -8434670561345810590L},
                    {-3191705981967644108L, 5741498073033336813L, -3528438667627766828L, 520481275508828399L, -7992048138970598731L,
                            492934643625072069L,
                            -7110033972178617171L, 4279782663096899588L, 8636902460438095456L, 5720434209558618099L, 3340404419044700883L,
                            -3499927803156768711L, 8793470242681731134L, -7673843985682194217L, -6853491646783973851L, -8213440450659039913L,
                            -861062413380896599L, -1953877182002879931L, 2965217575656062235L},
                    {-7109128665558831650L, 8598569923911306193L, -8023592498871461881L, -2589433071984133315L, 6855642701639775616L,
                            -2107343906389897158L
                            , 6326613644090501721L, -3884746970057969751L, 1555955735348807588L, -7061451779914017476L, 3089247762123083883L,
                            7687255064147207057L, -3828625525645665820L, -4119408507125538430L, -2609918868405339421L, -5213512724986955589L,
                            2407298501411356303L, 2430214722394261900L, 7854141528109551192L},
                    {4457257511274817535L, -6681948224202553560L, -6231558825798052307L, 7606167230041763288L, -2945898690525442099L,
                            -2372985152482511131L
                            , -6060940907403248883L, -6086092828689083037L, -5246100056380337500L, 2405381169144857905L, 8851042022198631719L,
                            4252676829254861933L, -847158722803300964L, -2186677934023479254L, -2481824830496511668L, 8909377504186546272L,
                            -5105886198272758051L, 716190844232310563L, -7685211111573112161L},
                    {-5526707823758395624L, -2412464570443082714L, 1804571517144356131L, 9032048909543739672L, 1194276179605399909L,
                            -4794864310623250105L,
                            -4691607996728675483L, 459162030173329409L, -4906800854799170164L, -5972038422096023897L, -347091365798704170L,
                            1307207148255411324L, 3076993201045916102L, -4406045169819562050L, -672107990216227941L, 8901023538549052410L,
                            -2319961814104602944L, 1907201063883887004L, -4062685296717429368L},
                    {-1458447326603816251L, 72520369377032730L, 2504023206924321121L, 1315032411642037417L, -671118087238692233L,
                            -5937697448152876824L,
                            2914069232554644162L, -122761879731138883L, -2704799728189953919L, -3595630054475699660L, -6904106471410655605L,
                            5398810977192619702L, -6244681884589765467L, 3001783947703718265L, 9096083008774451479L, 7106685045394120506L,
                            1612660455506562941L, -1602009131231155926L, 4674088701860260058L},
                    {3523904087147023653L, -7471386555745361678L, 6434863598619692329L, 3519486867992011992L, 2580325349084506629L,
                            1716045732687783621L,
                            -7492979958698560176L, -4514641440177765589L, 3721608777574387356L, -1662765351114890487L, 3457037762958540780L,
                            -1786853829876224128L, 248111902982172002L, 7021821483321584294L, -674607528851895236L, -5377863048748727910L,
                            3239836820672025857L, -542131753336640552L, 7455127606425822455L},
                    {-8433798860595663922L, -7827355596420365609L, 9037636573022094511L, -5597885248886916413L, -6534457901618775674L,
                            2873164154785547639L
                            , -6976432919709111923L, 870749536813772479L, -657313771171275329L, -2030155609682579672L, -5884872325010760789L,
                            7796026391804013818L, -5055358973622365814L, -2575071879188031388L, 4573049482515738515L, -4182482811943135495L,
                            6046612403613778574L, 4236824526478602843L, 1519069035286700967L},
                    {-503459130798834123L, -4135657787073785468L, -7474484335604143762L, -9033098866145950055L, 2897994414640787098L,
                            1577345017525264570L,
                            -5929109332358473804L, 5523996186651897329L, -2108240452905776886L, -4239384035193392495L, -8037792931226335368L,
                            -2016538154394010485L, -8120733856671044136L, -3974364924066260993L, -5305859667596474952L, -4843071080559888106L,
                            -3047142102766291122L, 1226219407302291214L, -3478653785880017752L}
            },
            {
                    {7734917412867290262L, 6284655895617668135L, 2306067779748196699L, 2022830897571499565L, 2627205915069464802L,
                            -2140955135540211179L,
                            -738210759093267816L, 4615062222046398051L, 4013703381314778918L, 8274994833083607100L, -619877387534848246L,
                            -3879485847376364008L, 2116826448048082531L, -4896728085068574283L, 6946059581591718411L, -8870290817678912178L,
                            -4918981758853938710L, -5964775386426611700L, 4116189569775180937L},
                    {7831202891648544189L, -7401994063206987803L, 6878459521612688835L, -4264000680470121595L, -6881170667520725682L,
                            -3724653382716647474L
                            , 2156599092525250765L, -2937053504604676458L, -1413663493026443103L, -7339472074020175626L, -4098722162669638381L,
                            -8618560730976276892L, -7146726688533394040L, -2122676787348598528L, -7395427032786680077L, 5426510996756284205L,
                            2520529158009521546L, -6462189850433074589L, -7389193909352499781L},
                    {-9032341298893821118L, -5670928062488475551L, 3619186373120223979L, 2749265425633789491L, 5517423544602562955L,
                            6965334283338688124L,
                            -5080735095734091208L, -578681586004124400L, 7293873677941390335L, -7030934945593191554L, 8477827402243921981L,
                            -4577107210731437694L, -5925264695113328083L, -7214107005829375811L, -5506197281131551806L, -2810107278736115801L,
                            2004933261750330295L, 4034581097433536452L, -8083687514551185181L},
                    {-828129162780382443L, -7809650130815596847L, 7234697674030832849L, -8751544775354361968L, -7710400284952876716L,
                            8460793956912899782L,
                            6280497513131622743L, 7350440158659813899L, 1784841081860287585L, 8422871041163422323L, -965564426268795267L,
                            -6629197302215179412L, -8049517076383861459L, -6376478374656402741L, -5959908271857496162L, -7940018618423296480L,
                            3573508937463707164L, -7698105062257028783L, -1436209506562243384L},
                    {7768833840944372326L, 3056411515141918087L, 8977436188069197473L, 3496384969179407677L, -3712908322158703407L,
                            -4141174888604086214L,
                            -1497188674310172441L, -5300086064934321676L, -7166448678211425079L, 6623621006414881782L, 4518079702256902758L,
                            1955111295031580696L, 3796312547030989577L, 3661609255901604336L, -6626129902469933070L, 8181095461501838216L,
                            488995529730258978L, -6074348408224450224L, -5823796318409472138L},
                    {-5285267871826722474L, -3478208648716121353L, 4167007375016552884L, -5512448357981815184L, -1032123338318716344L,
                            316282143357515583L,
                            7267127144720575914L, -7170683602990161808L, 7764327792086486362L, -1798168679241669625L, -1687537570720039623L,
                            2568113147229771164L, 6009046252331332154L, 8401323599624679981L, 3893295628570726489L, -1784755660671596241L,
                            -3466490996745974837L, 2533265712959218406L, 951729618158070134L},
                    {1415607913727031286L, 93435962177065635L, 4469457949562146361L, -6676764109549539343L, 525942964177882833L,
                            -6215405458447204468L,
                            -8862258266520852095L, -3639685170729330017L, -7536288229206697672L, 4991279332330692102L, -7521133836401091090L,
                            -884137435840746936L, 7071477597234773939L, 2692247875719540420L, -7010731526032019707L, 2693121140150924329L,
                            -1673111696883296671L, -4763830675485615573L, -7392721363147886308L},
                    {-9014643123516064653L, 228805445945981810L, -5682320974808763690L, -6009883253757784097L, 6235148815768871113L,
                            -7249145092442929747L,
                            5847540260730472468L, -3014169459141172018L, -6865430414595353914L, -8690651701902540053L, 4361322575126661224L,
                            8055934696809848252L, -7933617965725605259L, -4306841364203829606L, 8461570198219764744L, -67411858521640111L,
                            7437561948727498967L, 5549638476652136507L, -3351804786373288096L},
                    {-1506669546566209655L, 7225776422153724513L, 5023290736514519523L, -1606198633251355252L, -3310974761104276428L,
                            3456691052118575483L,
                            4061703097011994302L, -4484694211340227871L, 7147645917380522356L, -5843237345670168318L, -5654223276301776504L,
                            3898699306255109988L, -3151632543820317631L, -7916341074554487098L, -7000789306465850606L, -2242003357789097647L,
                            4860104306423411944L, 3825339021795911181L, 8147180397217351875L},
                    {-8242525446767435882L, -7404056208238228088L, 1291446042079347214L, 2958024171254625044L, -8939479500406940587L,
                            -4043875834148667244L
                            , 560962016363401335L, 2698020313985938451L, -1574686122075189402L, -7485932564694448300L, -1543335248635372568L,
                            -4823628802541769247L, 4619473332051511506L, -8238925062588538781L, 6361888308478469750L, 8089487230819993908L,
                            8924115155629232985L, -3492019019273263566L, -7209005066117405655L},
                    {-4480797457929915434L, -6846818653744883987L, 7707013273063716228L, 8852734292373652862L, -7641827907603468508L,
                            -4277778731848381643L
                            , -5064728124122995728L, 2629727869972615653L, 5526487542541348495L, 5737868690394806795L, 3397952328816363107L,
                            2477652760667574851L, -6144679069536385506L, -501243544885865986L, 5845873883520599963L, 1212244280200956786L,
                            733388992098871531L, 7165218218851600593L, 3207551696799665837L},
                    {2168634667845879997L, 4270918668139345825L, 9174645986812628474L, 2830759478189585791L, -3905573697391053211L,
                            -959447380948705531L,
                            -3047035267208147676L, -6041241197181644978L, 2467338065207643166L, -6774950472578677142L, -6500103655898300243L,
                            -3582516195255599318L, -3883680022514514030L, 2056991302307106363L, 5840689811149984809L, -5943385918011728267L,
                            7264485070837757661L, 8782065876135714421L, -1623458469763574051L},
                    {1606848783699932008L, -6605068065266183409L, 4331356014834730281L, -3063468667442217404L, -7919156802687256690L,
                            1678136781567781549L,
                            -2293121878016056065L, 7347418025478060174L, -2308476605175173561L, 190009814539443249L, -6702089788325989458L,
                            -1559888386028859620L, -7587876044939392185L, 458258896344014981L, 8465288455130515589L, 5162380060722682117L,
                            -8890857981775795948L, 634901307466147212L, -3497580969459418394L},
                    {6268679384117198229L, 4249231771130302347L, -1677972194096334694L, 5735939463686983877L, 6415722079875270345L,
                            1546183968876071515L,
                            -4469078272142589706L, -2522822385917526739L, -7264858366175575085L, -546605576264872056L, 2724150108894202463L,
                            5552660459633110715L, 327702034468174748L, -965192303023311382L, -9026047032332066940L, 7414690909771820577L,
                            -6896533871823196355L, -1604918662557008981L, 2136761413458637963L},
                    {8875827657015725220L, 7162418153223105669L, 8863940200874368205L, 7554611453016662411L, -5894607293488012641L,
                            6650948379465592951L,
                            4868280799586531746L, 4226317223770270993L, 9213035236924907006L, 3664120032483006920L, -3004946235017720494L,
                            7017567978093586079L, 1405776467544203460L, 6880845076340075365L, -4635649356422482856L, 6225413732232483112L,
                            4032923283479244677L, -3985444963061702933L, 1834975339042898693L},
                    {6812169978018241942L, 3905001145889927148L, -8794319434296621267L, 6588517075026177020L, 4216835345849234757L,
                            -332073493555939529L,
                            6916802886986171058L, 5152324262889551540L, -6504584132442549115L, 5300413106862303414L, 5033218926091173429L,
                            778900956365538810L, 5084859007528138011L, 4013393887471084623L, 6277154429215983395L, -1233448355859796372L,
                            6876524401965336768L, 8160395858112021757L, 6011803973243383328L},
                    {4656376210006596862L, -8946212389072665695L, 5942215320549846860L, 4035717295865739650L, 7273966112365317497L,
                            -3359223274839705891L,
                            3873479164883021791L, -7794222234928240684L, 7874326763662479607L, -5740444624229401845L, 306009600840509931L,
                            -6647460971866045867L, -2292486798460132247L, -1414057283354449231L, 7067116782011618745L, -7520109257346515081L,
                            -3107229770507217135L, 690076451350834382L, -7121594462012240088L},
                    {8816790572793132384L, -979612721224433400L, 1624668383166074705L, -2629468626862083032L, 1598648794578820204L,
                            6750912379148683705L,
                            -2262495657390689889L, -2005389586796276928L, -2890827160994160215L, 2578733904674094692L, 6569275690022338321L,
                            4942592621160999432L, 2498460600811882841L, 4036906295951653020L, 4601909847640815987L, -9087086356838468688L,
                            -4630609941887819404L, -5776362412710275894L, 7563861142071481223L},
                    {8948314328603953016L, 1441205794454815779L, -9185657657308825433L, 3184547518404221824L, 2896388572375729974L,
                            -8119168658774988218L,
                            -6541069936538015290L, 575146737749947783L, 5308773001769721299L, 6369530529371491823L, 4453662249830331400L,
                            5315215959046170170L, -1777581013478650418L, -8005579654051898139L, -1620215734229770203L, -1161985263481443032L,
                            -4081617970280525897L, -5923672518089491678L, 6523025871406856746L}
            }
    };

    // 虚着的Key值
    private static final long PASS_MOVE_KEY = 3249913293473197278L;

    private Game mBoard;

    private HashKey mCurrentKey;

    public ZobristHash(Game board, HashKey hashKey) {
        this(board);
        mCurrentKey = hashKey;
    }

    public ZobristHash(Game board) {
        this.mBoard = board;
        initialize();
    }

    private void initialize() {
        mCurrentKey = getInitialKey();
    }

    private HashKey getInitialKey() {
        mCurrentKey = new HashKey();
        int boardSize = mBoard.getBoardSize();
        for (int i = 0; i < boardSize; i++) {
            for (int j = 0; j < boardSize; j++) {
                Intersection intersection = new Intersection(i, j);
                if (mBoard.occupied(intersection)) {
                    applyPositionToKey(i, j, getStateIndex(intersection));
                }
            }
        }
        return mCurrentKey;
    }

    /**
     * 获取当前棋盘状态的Hash值
     *
     * @return
     */
    public HashKey getKey() {
        return mCurrentKey;
    }

    public void applyMove(int x, int y, int stateIndex) {
        applyPositionToKey(x, y, stateIndex);
    }

    public void applyPassingMove() {
        mCurrentKey.applyMove(PASS_MOVE_KEY);
    }

    public void applyMoveNumber(int number) {
        mCurrentKey.applyMove(number);
    }

    private void applyPositionToKey(int x, int y, int stateIndex) {
        long specialNum = RANDOM_TABLE[stateIndex][x][y];
        mCurrentKey.applyMove(specialNum);
    }

    /**
     * 一个位置的状态数。空0、黑1、白2
     *
     * @return
     */
    private int getNumPositionStates() {
        return 3;
    }

    /**
     * 获取指定位置的状态序号
     *
     * @param intersection
     * @return
     */
    private int getStateIndex(Intersection intersection) {
        Chain chain = mBoard.getChain(intersection);
        if (chain != null) {
            switch (chain.getStoneColor()) {
                case BLACK:
                    return STATE_BLACK;
                case WHITE:
                    return STATE_WHITE;
            }
        }
        return STATE_EMPTY;
    }
}
